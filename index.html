<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FunMaker1404 ‚Äî Studio+ Adaptatif + Coins & Boutique</title>
<style>
  :root{ --bg:#0b0b11; --bg2:#0e0e15; --card:#12131a; --muted:#aab; --text:#eef;
         --brand:#7c3aed; --brand2:#22d3ee; --ok:#10b981; --bad:#ef4444; --border:#242636; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 800px at 10% -10%, rgba(124,58,237,.25), transparent),
                      radial-gradient(900px 600px at 110% 20%, rgba(34,211,238,.2), transparent),
                      linear-gradient(180deg,var(--bg),var(--bg2));
       color:var(--text); font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .shell{max-width:1150px;margin:0 auto;padding:20px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px}
  .logoWrap{display:flex;gap:10px;align-items:center}
  .title{font-weight:800;font-size:20px}
  .muted{color:var(--muted);font-size:12px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  select,input,textarea,button{border:1px solid var(--border);background:#0f1118;color:var(--text);border-radius:12px;padding:10px 12px}
  input[type="number"]{width:140px} textarea{width:100%;min-height:110px}
  button{cursor:pointer} .btn{background:#1a1c27} .btn:hover{filter:brightness(1.1)}
  .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#041014; border:none; font-weight:700}
  .grid{display:grid;gap:16px} @media(min-width:980px){ .grid-2{grid-template-columns:1fr 1fr} }
  .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01)); border:1px solid var(--border);
        border-radius:18px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .card h2{margin:0 0 8px 0; font-size:16px}
  .pill{font-size:11px;padding:4px 8px;border:1px solid var(--border);border-radius:999px;background:rgba(255,255,255,.05)}
  .opt{display:block;width:100%;text-align:left;margin:6px 0;padding:10px;border-radius:10px;border:1px solid #1f2130;background:#121424}
  .opt.ok{background:var(--ok);color:#041014;border-color:transparent}
  .opt.bad{background:var(--bad);color:#041014;border-color:transparent}
  .kpi{display:flex;gap:8px;align-items:center;font-size:12px} .kpi b{font-size:14px}
  .bar{height:8px;background:#222538;border-radius:999px;overflow:hidden}
  .bar>div{height:100%;background:linear-gradient(90deg,var(--brand),var(--brand2))}
  .code{background:#0c0f18;border:1px solid #1e2233;border-radius:12px;padding:10px;white-space:pre-wrap}
  .center{display:grid;place-items:center} .tag{font-size:11px;opacity:.8}
  .wheelWrap{position:relative;width:260px;height:260px} .pin{position:absolute;left:50%;top:-4px;transform:translateX(-50%);font-size:22px}
  .wheel{width:100%;height:100%;border-radius:50%;border:1px solid var(--border);background:#0f1118}
  .logoSvg{width:48px;height:48px} img.preview{max-width:100%;border-radius:12px;border:1px solid var(--border)}
  .lock{opacity:.5;filter:grayscale(1)} .badge{font-size:11px;background:#7c3aed22;border:1px solid var(--border);padding:4px 8px;border-radius:999px}
  .coins{display:flex;align-items:center;gap:6px;border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.04)}
</style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="logoWrap">
        <!-- Logo ninja / shuriken + √©clair -->
        <svg class="logoSvg" viewBox="0 0 100 100" role="img" aria-label="Logo ninja">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#7c3aed"/><stop offset="1" stop-color="#22d3ee"/></linearGradient>
            <radialGradient id="glow" cx="50%" cy="50%" r="60%"><stop offset="0" stop-color="rgba(255,255,255,0.35)"/><stop offset="1" stop-color="rgba(255,255,255,0)"/></radialGradient>
            <filter id="soft" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur stdDeviation="1.2"/></filter>
          </defs>
          <circle cx="50" cy="50" r="46" fill="url(#g1)" />
          <circle cx="50" cy="50" r="42" fill="#0f1118" stroke="rgba(255,255,255,.15)" stroke-width="1.5"/>
          <g fill="url(#g1)" opacity="0.95"><path d="M50 16 L56 40 L84 50 L56 60 L50 84 L44 60 L16 50 L44 40 Z" /></g>
          <path d="M57 24 L45 52 L60 52 L43 78 L52 56 L38 56 Z" fill="#22d3ee" stroke="#7c3aed" stroke-width="1.2" filter="url(#soft)" opacity="0.95"/>
          <circle cx="36" cy="34" r="14" fill="url(#glow)" opacity="0.6"/>
        </svg>
        <div>
          <div class="title">FunMaker1404</div>
          <div class="muted">Adaptatif (IA-like) ‚Ä¢ Langues ‚Ä¢ Programmation ‚Ä¢ Quiz ‚Ä¢ Roue ‚Ä¢ Sondage ‚Ä¢ Timer</div>
        </div>
      </div>
      <div class="row">
        <div class="coins" title="Pi√®ces (gagn√©es dans les activit√©s)">
          ü™ô <b id="coinCount">0</b>
        </div>
        <select id="level">
          <option>Primaire</option><option selected>6e</option><option>5e</option><option>4e</option><option>3e</option><option>Lyc√©e</option>
        </select>
        <select id="subject">
          <option>Maths</option><option>Fran√ßais</option><option>Anglais</option><option>Sciences</option><option selected>Mix</option>
        </select>
        <button class="btn primary" id="startPack">D√©marrer</button>
        <button class="btn" id="togglePremium">Activer Premium (d√©mo)</button>
        <span id="premiumBadge" class="badge">Gratuit</span>
      </div>
    </header>

    <div class="grid grid-2">
      <!-- Entra√Ænement adaptatif -->
      <section class="card">
        <div class="row" style="justify-content:space-between">
          <h2>‚ö° Entra√Ænement adaptatif (IA-like)</h2>
          <span class="pill" id="aiMeta">Niveau: 6e ‚Ä¢ Diffic.: 3</span>
        </div>
        <div id="aiZone"></div>
        <div class="row"><button class="btn primary" id="aiStart">Lancer 10 questions</button><span class="muted" id="aiScore"></span></div>
        <div class="muted">R√©compense : <b>+5</b> coins par bonne r√©ponse</div>
      </section>

      <!-- Programmation ‚Äî d√©fis -->
      <section class="card" id="codeCard">
        <div class="row" style="justify-content:space-between"><h2>üíª Programmation ‚Äî d√©fis adapt√©s</h2><span class="tag">+10 coins si tous les tests passent</span></div>
        <div id="codeTask" class="muted"></div>
        <textarea id="codeArea" class="code" rows="7">// √âcris ta solution ici</textarea>
        <div class="row"><button class="btn primary" id="runCode">Tester</button><span id="codeFeedback" class="muted"></span></div>
      </section>

      <!-- Langues ‚Äî gratuit -->
      <section class="card">
        <div class="row" style="justify-content:space-between"><h2>üåç Langues (gratuit)</h2><span class="tag">+2 coins / bonne r√©ponse</span></div>
        <div id="langFree"></div>
      </section>

      <!-- Langues Plus (Premium) -->
      <section class="card" id="langPlusCard">
        <div class="row" style="justify-content:space-between"><h2>üåü Langues Plus (Premium)</h2><span class="tag">Phrases, conjugaison, faux amis</span></div>
        <div id="langPlus"></div>
      </section>

      <!-- Boutique / Premium -->
      <section class="card">
        <div class="row" style="justify-content:space-between"><h2>üõí Boutique & Premium</h2><span class="tag">Simulation locale</span></div>
        <div class="row">
          <button class="btn" id="buyMonthly">Premium 2,99‚Ç¨ / mois (d√©mo)</button>
          <button class="btn" id="buyYearly">Premium 9,99‚Ç¨ / an (d√©mo)</button>
          <button class="btn" id="buyLifetime">Premium 14,99‚Ç¨ √† vie (d√©mo)</button>
          <button class="btn" id="buyWithCoins">D√©bloquer avec 500 ü™ô</button>
        </div>
        <div class="muted">Ces boutons **simulent** un achat. Pour de vrais paiements on branchera Stripe plus tard.</div>
      </section>

      <!-- Quiz pr√©d√©finis -->
      <section class="card">
        <div class="row" style="justify-content:space-between">
          <h2>üìù Quiz pr√©d√©finis</h2><span class="pill" id="quizMeta">6e ‚Ä¢ Maths</span>
        </div>
        <div id="quizQ"></div><div id="quizChoices"></div>
        <div class="row"><button class="btn" id="prevQuiz">‚óÄ Pr√©c.</button><span class="muted" id="quizIndex">1/1</span><button class="btn" id="nextQuiz">Suiv. ‚ñ∂</button></div>
      </section>

      <!-- Roue -->
      <section class="card">
        <div class="row" style="justify-content:space-between"><h2>üé° Roue</h2><span class="tag">Co√ªt : 1 ü™ô ‚Äî Gain : 0‚Äì20 ü™ô</span></div>
        <div class="row"><input class="wheelOpt" placeholder="Option 1"/><input class="wheelOpt" placeholder="Option 2"/><input class="wheelOpt" placeholder="Option 3"/><input class="wheelOpt" placeholder="Option 4"/><input class="wheelOpt" placeholder="Option 5"/><input class="wheelOpt" placeholder="Option 6"/></div>
        <div class="center" style="margin-top:8px"><div class="wheelWrap"><div class="pin">‚ñº</div><svg id="wheel" class="wheel" viewBox="0 0 100 100"></svg></div></div>
        <div class="row center" style="margin-top:8px"><button class="btn primary" id="spin">Lancer</button><span class="muted" id="winner"></span></div>
      </section>

      <!-- Sondage -->
      <section class="card">
        <div class="row" style="justify-content:space-between"><h2>üìä Sondage</h2><span class="tag">Local (d√©mo)</span></div>
        <input id="pollTitle" placeholder="Titre du sondage"/><div id="poll"></div>
      </section>

      <!-- Tirage -->
      <section class="card"><h2>üé≤ Tirage au sort</h2>
        <div class="row"><input id="drawInput" placeholder="Noms, s√©par√©s par des virgules"/><button class="btn primary" id="drawBtn">Tirer</button></div>
        <div class="kpi"><span class="muted">Gagnant :</span><b id="drawOut">‚Äî</b></div>
      </section>

      <!-- Timer -->
      <section class="card"><h2>‚è∞ Compte √† rebours</h2>
        <div class="row"><input id="timerMin" type="number" placeholder="Minutes"/><button class="btn primary" id="timerGo">D√©marrer</button></div>
        <div class="kpi"><span class="muted">Temps restant :</span><b id="timer">00:00</b></div>
      </section>
    </div>

    <section class="card center muted" style="margin-top:14px">
      Coins & Boutique en mode **d√©mo locale**. Pour paiements r√©els : ajouter Stripe plus tard.
    </section>
  </div>

<script>
/* ===== Helpers & stockage ===== */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const rint=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const shuffle=a=>a.map(v=>[v,Math.random()]).sort((x,y)=>x[1]-y[1]).map(x=>x[0]);

/* Coins */
let coins = parseInt(localStorage.getItem("fm_coins")||"0",10);
function saveCoins(){ localStorage.setItem("fm_coins", String(coins)); }
function showCoins(){ $('#coinCount').textContent = coins; }
function addCoins(n){ coins=Math.max(0, coins+n); saveCoins(); showCoins(); }
function spendCoins(n){ if(coins>=n){ coins-=n; saveCoins(); showCoins(); return true; } return false; }

/* Premium (d√©mo) */
let premium = localStorage.getItem("fm_premium")==="1";
function updatePremiumUI(){
  $('#premiumBadge').textContent = premium ? "Premium (d√©mo)" : "Gratuit";
  $('#togglePremium').textContent = premium ? "D√©sactiver Premium (d√©mo)" : "Activer Premium (d√©mo)";
  $('#langPlusCard').classList.toggle('lock', !premium);
}
$('#togglePremium').onclick=()=>{ premium=!premium; localStorage.setItem("fm_premium", premium?"1":"0"); updatePremiumUI(); };

/* Boutique (simulation) */
$('#buyMonthly').onclick=()=>{ premium=true; localStorage.setItem("fm_premium","1"); updatePremiumUI(); alert("Premium mensuel activ√© (d√©mo)."); };
$('#buyYearly').onclick=()=>{ premium=true; localStorage.setItem("fm_premium","1"); updatePremiumUI(); alert("Premium annuel activ√© (d√©mo)."); };
$('#buyLifetime').onclick=()=>{ premium=true; localStorage.setItem("fm_premium","1"); updatePremiumUI(); alert("Premium √† vie activ√© (d√©mo)."); };
$('#buyWithCoins').onclick=()=>{ if(spendCoins(500)){ premium=true; localStorage.setItem("fm_premium","1"); updatePremiumUI(); alert("Premium d√©bloqu√© avec 500 ü™ô !"); } else { alert("Pas assez de pi√®ces (500 requises)."); } };

/* ===== Entra√Ænement adaptatif ===== */
const state={ diff:3, total:0, good:0 };
function aiMeta(){ $('#aiMeta').textContent=`Niveau: ${$('#level').value} ‚Ä¢ Diffic.: ${state.diff}`; $('#aiScore').textContent=`Score: ${state.good}/${state.total}`; }
function qMath(diff){
  const type = diff<4 ? "addsub" : diff<7 ? (Math.random()<.6?"mult":"frac") : (["pct","exp","eq"][rint(0,2)]);
  if(type==="addsub"){ const a=rint(1, 10*diff), b=rint(1, 10*diff), op=Math.random()<.5?'+':'-'; const ans= op==='+'?a+b:a-b;
    const opts=shuffle([ans, ans+diff, ans-diff, ans+2]); return {t:`${a} ${op} ${b} = ?`, opts:opts.map(String), ok:opts.indexOf(ans)}; }
  if(type==="mult"){ const a=rint(2, 2+diff), b=rint(2, 3+diff); const ans=a*b; const opts=shuffle([ans, ans+diff, ans-2, ans+3]).map(String);
    return {t:`${a} √ó ${b} = ?`, opts, ok:opts.indexOf(String(ans))}; }
  if(type==="frac"){ const d=rint(2, 4+Math.floor(diff/2)), n1=rint(1,d-1), n2=rint(1,d-1); const ans=(n1+n2)+'/'+d;
    const opts=shuffle([ans,(n1+n2+1)+'/'+d,(n1+n2-1)+'/'+d,(n1)+'/'+d]); return {t:`${n1}/${d} + ${n2}/${d} = ?`, opts, ok:opts.indexOf(ans)}; }
  if(type==="pct"){ const base=rint(50,50+diff*30), p=rint(5, 10+diff*5); const ans=Math.round(base*p/100);
    const opts=shuffle([ans, ans+10, ans-10, ans+20]).map(String); return {t:`${p}% de ${base} = ?`, opts, ok:opts.indexOf(String(ans))}; }
  if(type==="exp"){ const a=rint(2,3+Math.floor(diff/3)), e=rint(2,3+Math.floor(diff/4)); const ans=String(a**e);
    const opts=shuffle([ans, String(a**(e-1)), String((a+1)**e), String(a**e + a)]); return {t:`${a}<sup>${e}</sup> = ?`, html:true, opts, ok:opts.indexOf(ans)}; }
  if(type==="eq"){ const x=rint(1,5+diff), a=rint(1,5+diff), b=rint(1,5+diff), c=a*x+b; const ans=x;
    const opts=shuffle([x,x+1,x-1,x+2]).map(String); return {t:`R√©sous: ${a}x + ${b} = ${c}. x = ?`, opts, ok:opts.indexOf(String(ans))}; }
}
function qLang(diff){
  const vocab=[["cat","chat"],["dog","chien"],["blue","bleu"],["house","maison"],["tree","arbre"],["car","voiture"]];
  if(diff<4){ const [en,fr]=vocab[rint(0,vocab.length-1)]; const opts=shuffle([fr,"pomme","chaise","livre"]);
    return {t:`Traduire en fran√ßais: <b>${en}</b>`, html:true, opts, ok:opts.indexOf(fr)}; }
  if(diff<7){ const who=["I","You","He","She","We","They"][rint(0,5)], verb=["like","see","eat","have"][rint(0,3)], obj=["apples","cats","music","books"][rint(0,3)];
    const sent=`${who} ${verb} ${obj}.`; const good=`${who==="He"||who==="She"?"Il/Elle":"Je/Ns/Ils"} ${verb==="like"?"aime":"vois"} ${obj==="apples"?"des pommes":obj==="cats"?"les chats":obj==="music"?"la musique":"des livres"}.`;
    const opts=shuffle([good,"Moi aime pommes.","Je vois chats.","Nous avons livres."]); return {t:`Traduis: ¬´ ${sent} ¬ª`, opts, ok:opts.indexOf(good)}; }
  const pronom=["Je","Tu","Il","Elle","Nous","Vous","Ils"][rint(0,6)], base="manger";
  const good = pronom==="Je"?"mange":pronom==="Tu"?"manges":(pronom==="Il"||pronom==="Elle")?"mange":pronom==="Nous"?"mangeons":pronom==="Vous"?"mangez":"mangent";
  const opts=shuffle([good,"manger","mangea","mangera"]); return {t:`Conjugue <b>${base}</b> au pr√©sent pour ¬´ ${pronom} ¬ª`, html:true, opts, ok:opts.indexOf(good)};
}
function startAI(){
  state.total=0; state.good=0;
  const zone=$('#aiZone'); zone.innerHTML='';
  const list=Array.from({length:10},()=>$('#subject').value==="Mix" ? (Math.random()<.5?"Maths":"Anglais") : $('#subject').value);
  let i=0;
  function ask(){
    zone.innerHTML='';
    const subj=list[i];
    const q = (subj==="Maths") ? qMath(state.diff) : qLang(state.diff);
    const qDiv=document.createElement('div'); qDiv.style.margin='6px 0'; qDiv.innerHTML = q.html? q.t : q.t.replaceAll("<","&lt;");
    zone.append(qDiv);
    q.opts.forEach((o,idx)=>{
      const b=document.createElement('button'); b.className='opt'; b.innerHTML=o;
      b.onclick=()=>{
        state.total++;
        if(idx===q.ok){ state.good++; state.diff=Math.min(10,state.diff+1); b.classList.add('ok'); addCoins(5); }
        else { state.diff=Math.max(1,state.diff-1); b.classList.add('bad'); }
        aiMeta();
        setTimeout(()=>{ if(i<9){ i++; ask(); } else { zone.innerHTML=`<div class="kpi"><span class="muted">R√©sultat</span> ‚Ä¢ <b>${state.good}/10</b> ‚Ä¢ Difficult√© finale: <b>${state.diff}</b></div>`; } }, 550);
      };
      zone.append(b);
    });
    aiMeta();
  }
  ask();
}
$('#aiStart').onclick=startAI;

/* ===== Programmation (g√©n√©ration + √©valuation) ===== */
function qProg(diff){
  const pool=[];
  pool.push(()=>({ desc:"Retourne la somme de a et b", sig:"function solve(a,b){ /* ton code */ }", tests:[[1,2,3],[5,7,12],[3,0,3]] }));
  pool.push(()=>({ desc:"Renvoie vrai si n est pair", sig:"function solve(n){ /* ton code */ }", tests:[[2,true],[9,false],[0,true]] }));
  if(diff>=5) pool.push(()=>({ desc:"Renvoie le plus grand nombre du tableau", sig:"function solve(arr){ /* ton code */ }", tests:[[[1,5,2],5],[[9,3,-1],9],[[7],7]] }));
  if(diff>=7) pool.push(()=>({ desc:"Renvoie la cha√Æne invers√©e", sig:"function solve(s){ /* ton code */ }", tests:[["abc","cba"],["kayak","kayak"],["JS","SJ"]] }));
  if(diff>=9) pool.push(()=>({ desc:"Vrai si palindrome (ignorer espaces/majuscules)", sig:"function solve(s){ /* ton code */ }", tests:[["A man a plan a canal Panama",true],["kayak",true],["test",false]] }));
  return pool[rint(0,pool.length-1)]();
}
let curTask=null;
function newCodeTask(){ curTask=qProg(state.diff); $('#codeTask').innerHTML=`<b>Consigne :</b> ${curTask.desc}<br/><b>Signature :</b><pre class="code" style="margin-top:6px">${curTask.sig}</pre>`; $('#codeArea').value=curTask.sig+"\n"; }
function evalUser(code){
  try{
    const f = new Function(code + "; return typeof solve==='function'?solve:null;");
    const solve = f();
    if(!solve) return "‚ùå Tu dois d√©finir une fonction solve(...)";
    for(const t of curTask.tests){
      const arr = Array.isArray(t[0]) && t.length===2 ? t[0] : (t.length===3 ? [t[0],t[1]] : t.slice(0,t.length-1));
      const expected = t[t.length-1];
      const got = Array.isArray(arr) ? solve(...arr) : solve(arr);
      if(JSON.stringify(got)!==JSON.stringify(expected)) return `‚ùå Test rat√©. Entr√©e=${JSON.stringify(arr)} ‚Ä¢ Attendu=${JSON.stringify(expected)} ‚Ä¢ Obtenu=${JSON.stringify(got)}`;
    }
    state.diff=Math.min(10, state.diff+1); aiMeta(); addCoins(10);
    return "‚úÖ Tous les tests sont pass√©s ! (+10 ü™ô, difficult√© +1)";
  }catch(e){ return "Erreur: "+e.message; }
}
$('#runCode').onclick=()=>{ const res=evalUser($('#codeArea').value); $('#codeFeedback').textContent = res; if(res.startsWith("‚úÖ")) newCodeTask(); };

/* ===== Langues (gratuit + premium) ===== */
function renderLangFree(){
  const root=$('#langFree'); root.innerHTML='';
  const vocab=[["cat","chat"],["dog","chien"],["blue","bleu"],["house","maison"],["car","voiture"],["book","livre"]];
  const [en,fr]=vocab[rint(0,vocab.length-1)];
  const p=document.createElement('div'); p.innerHTML=`Traduire en fran√ßais : <b>${en}</b>`; root.append(p);
  const choices=shuffle([fr,"chaise","poisson","pomme"]);
  choices.forEach(c=>{
    const b=document.createElement('button'); b.className='opt'; b.textContent=c;
    b.onclick=()=>{ if(c===fr){ b.classList.add('ok'); addCoins(2); } else { b.classList.add('bad'); } setTimeout(renderLangFree,600); };
    root.append(b);
  });
}
function renderLangPlus(){
  const root=$('#langPlus'); root.innerHTML='';
  if(!premium){ root.innerHTML='<div class="muted">üîí Contenu Premium (d√©mo). Clique ‚ÄúActiver Premium (d√©mo)‚Äù ou d√©bloque avec 500 ü™ô.</div>'; return; }
  const mode=["phrase","conjug","fauxami"][rint(0,2)];
  if(mode==="phrase"){
    const who=["I","You","He","She","We","They"][rint(0,5)], verb=["like","see","eat","have"][rint(0,3)], obj=["apples","cats","music","books"][rint(0,3)];
    const sent=`${who} ${verb} ${obj}.`;
    const good=`${(who==="He"||who==="She")?"Il/Elle":"Je/Ns/Ils"} ${verb==="like"?"aime":"vois"} ${obj==="apples"?"des pommes":obj==="cats"?"les chats":obj==="music"?"la musique":"des livres"}.`;
    const choices=shuffle([good,"Nous mange livres.","Je vois pommes.","Elle aime musique."]);
    const p=document.createElement('div'); p.innerHTML=`Traduction de phrase : ¬´ ${sent} ¬ª`; root.append(p);
    choices.forEach(c=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=c; b.onclick=()=>{ b.classList.toggle('ok',c===good); setTimeout(renderLangPlus,600); }; root.append(b); });
  } else if(mode==="conjug"){
    const pronom=["Je","Tu","Il","Elle","Nous","Vous","Ils"][rint(0,6)], base="aller";
    const good = {Je:"vais",Tu:"vas",Il:"va",Elle:"va",Nous:"allons",Vous:"allez",Ils:"vont"}[pronom];
    const p=document.createElement('div'); p.innerHTML=`Conjugue <b>${base}</b> au pr√©sent pour ¬´ ${pronom} ¬ª`; root.append(p);
    shuffle([good,"aller","ira","allait"]).forEach(c=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=c; b.onclick=()=>{ b.classList.toggle('ok',c===good); setTimeout(renderLangPlus,600); }; root.append(b); });
  } else {
    const pair=[["actually","en fait"],["library","biblioth√®que"],["sensible","raisonnable"],["eventually","finalement"]][rint(0,3)];
    const good=pair[1]; const p=document.createElement('div'); p.innerHTML=`Faux ami ‚Äî Traduire : <b>${pair[0]}</b>`; root.append(p);
    shuffle([good,"actuellement","sensiblement","√©v√©nementiel"]).forEach(c=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=c; b.onclick=()=>{ b.classList.toggle('ok',c===good); setTimeout(renderLangPlus,600); }; root.append(b); });
  }
}

/* ===== Quiz pr√©d√©finis ===== */
const QUIZ_DB=[
  { level:"Primaire", subject:"Maths", title:"Additions", q:[{t:"2 + 3 = ?", opts:["4","5","6","7"], ok:1},{t:"5 + 5 = ?", opts:["9","10","11","12"], ok:1}]},
  { level:"6e", subject:"Maths", title:"Fractions", q:[{t:"1/2 + 1/2 = ?", opts:["1/4","1","2","1/2"], ok:1},{t:"La moiti√© de 12", opts:["4","6","8","12"], ok:1}]},
  { level:"6e", subject:"Sciences", title:"Corps humain", q:[{t:"Organe qui pompe le sang ?", opts:["Poumon","Foie","C≈ìur","Rein"], ok:2},{t:"Os du bras ?", opts:["Tibia","Hum√©rus","Cr√¢ne","Vert√®bre"], ok:1}]},
];
let quizIndex=0;
function listQuiz(){ return QUIZ_DB.filter(q=> q.level===$('#level').value && q.subject===$('#subject').value); }
function renderQuiz(){
  const list=listQuiz(); const meta=$('#quizMeta'); const ch=$('#quizChoices'); const idx=$('#quizIndex');
  $('#quizQ').innerHTML=''; ch.innerHTML='';
  if(!list.length){ meta.textContent=$('#level').value+' ‚Ä¢ '+$('#subject').value; $('#quizQ').innerHTML='<span class="muted">Aucun quiz.</span>'; idx.textContent='‚Äî'; return; }
  const cur=list[quizIndex%list.length]; meta.textContent=`${cur.level} ‚Ä¢ ${cur.subject} ‚Äî ${cur.title}`; idx.textContent=`${(quizIndex%list.length)+1}/${list.length}`;
  cur.q.forEach((qq,qi)=>{ const head=document.createElement('div'); head.innerHTML=`<b>Q${qi+1}.</b> ${qq.t}`; head.style.margin='6px 0'; ch.append(head);
    qq.opts.forEach((o,i)=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=o;
      b.onclick=()=>{ [...ch.querySelectorAll('.opt')].forEach(btn=>btn.classList.remove('ok','bad')); b.classList.add(i===qq.ok?'ok':'bad'); }; ch.append(b); });
  });}
$('#prevQuiz').onclick=()=>{ const l=listQuiz(); if(!l.length) return; quizIndex=(quizIndex-1+l.length)%l.length; renderQuiz(); };
$('#nextQuiz').onclick=()=>{ const l=listQuiz(); if(!l.length) return; quizIndex=(quizIndex+1)%l.length; renderQuiz(); };

/* ===== Roue / Sondage / Tirage / Timer ===== */
function renderWheel(){
  const svg=$('#wheel'); svg.innerHTML='';
  const opts=$$('.wheelOpt').map(i=>i.value.trim()).filter(Boolean);
  const seg=Math.max(1,opts.length||6), per=360/seg;
  for(let i=0;i<seg;i++){
    const start=(i*per-90)*Math.PI/180, end=((i+1)*per-90)*Math.PI/180;
    const x1=50+50*Math.cos(start), y1=50+50*Math.sin(start);
    const x2=50+50*Math.cos(end), y2=50+50*Math.sin(end);
    const large=per>180?1:0;
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d',`M50,50 L${x1},${y1} A50,50 0 ${large} 1 ${x2},${y2} Z`);
    p.setAttribute('fill',`hsl(${(i*60)%360},70%,55%)`); p.setAttribute('opacity','.95'); svg.append(p);
    const t=document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x','50'); t.setAttribute('y','50'); t.setAttribute('text-anchor','middle'); t.setAttribute('font-size','4'); t.setAttribute('fill','#041014');
    t.setAttribute('transform',`rotate(${i*per+per/2} 50 50) translate(0 -34)`); t.textContent=(opts[i]||('Opt '+(i+1))).slice(0,10); svg.append(t);
  }
}
$$('.wheelOpt').forEach(i=> i.addEventListener('input', renderWheel));
renderWheel();
let angle=0, spinning=false;
$('#spin').onclick=()=>{
  if(!spendCoins(1)){ alert("Pas assez de pi√®ces pour lancer la roue (1 ü™ô)."); return; }
  const opts=$$('.wheelOpt').map(i=>i.value.trim()).filter(Boolean);
  const seg=Math.max(1,opts.length||6); if(spinning||seg===0) return; spinning=true; $('#winner').textContent='';
  const per=360/seg, target=Math.floor(Math.random()*seg), extra=360*5; angle += extra + (target+.5)*per;
  const svg=$('#wheel'); svg.style.transition='transform 3.2s cubic-bezier(.2,.9,.2,1)'; requestAnimationFrame(()=> svg.style.transform=`rotate(${angle}deg)`);
  setTimeout(()=>{ svg.style.transition='none'; spinning=false; const gain=rint(0,20); addCoins(gain); $('#winner').textContent='Gagnant : '+(opts[target]||('Option '+(target+1)))+' ‚Ä¢ Bonus: '+gain+' ü™ô'; }, 3300);
};

const POLL={ title:"Aimes-tu FunMaker ?", options:["Oui","Non","Bof","Je ne sais pas"], votes:[0,0,0,0] };
$('#pollTitle').value=POLL.title; $('#pollTitle').oninput=e=>POLL.title=e.target.value;
function drawPoll(){ const root=$('#poll'); root.innerHTML=''; const title=document.createElement('div'); title.className='muted'; title.textContent=POLL.title; root.append(title);
  POLL.options.forEach((opt,i)=>{ const row=document.createElement('div'); row.style.margin='8px 0';
    const top=document.createElement('div'); top.className='row'; const btn=document.createElement('button'); btn.className='btn'; btn.textContent='Voter';
    const lab=document.createElement('div'); lab.textContent=opt; lab.style.flex='1'; btn.onclick=()=>{ POLL.votes[i]++; updateBars(); };
    top.append(lab,btn); row.append(top); const bar=document.createElement('div'); bar.className='bar'; const fill=document.createElement('div'); bar.append(fill); row.append(bar); root.append(row); });
  updateBars(); }
function updateBars(){ const tot=POLL.votes.reduce((a,b)=>a+b,0)||1; $$('#poll .bar').forEach((b,i)=>{ b.firstChild.style.width=Math.round((POLL.votes[i]/tot)*100)+'%'; }); }
drawPoll();

$('#drawBtn').onclick=()=>{ const arr=$('#drawInput').value.split(',').map(s=>s.trim()).filter(Boolean);
  $('#drawOut').textContent=arr.length?arr[Math.floor(Math.random()*arr.length)] : '(ajoute des noms)'; };

let tIv=null; $('#timerGo').onclick=()=>{ clearInterval(tIv); let s=(parseInt($('#timerMin').value)||0)*60;
  const tick=()=>{ if(s<=0){ clearInterval(tIv); $('#timer').textContent='00:00'; return; }
    s--; const m=String(Math.floor(s/60)).padStart(2,'0'), ss=String(s%60).padStart(2,'0'); $('#timer').textContent=`${m}:${ss}`; };
  tick(); tIv=setInterval(tick,1000); };

/* ===== Init ===== */
function refreshAll(){ renderQuiz(); renderWheel(); renderLangFree(); renderLangPlus(); newCodeTask(); aiMeta(); showCoins(); }
$('#startPack').onclick=refreshAll;
window.addEventListener('load', ()=>{ updatePremiumUI(); showCoins(); refreshAll(); });
$('#level').addEventListener('change', ()=>{ state.diff=3; aiMeta(); renderQuiz(); });
$('#subject').addEventListener('change', renderQuiz);
</script>
</body>
</html>
