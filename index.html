<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FunMaker1404 ‚Äî Niveaux par Classe + Premium</title>
<style>
  :root{ --bg:#0b0b11; --bg2:#0e0e15; --card:#12131a; --muted:#aab; --text:#eef; --brand:#7c3aed; --brand2:#22d3ee; --ok:#10b981; --bad:#ef4444; --border:#242636; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 800px at 10% -10%, rgba(124,58,237,.25), transparent),
                      radial-gradient(900px 600px at 110% 20%, rgba(34,211,238,.2), transparent),
                      linear-gradient(180deg,var(--bg),var(--bg2));
       color:var(--text); font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .shell{max-width:1200px;margin:0 auto;padding:20px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px}
  .logoWrap{display:flex;gap:10px;align-items:center}
  .title{font-weight:800;font-size:20px}
  .muted{color:var(--muted);font-size:12px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  select,input,textarea,button{border:1px solid var(--border);background:#0f1118;color:var(--text);border-radius:12px;padding:10px 12px}
  textarea{width:100%;min-height:110px}
  button{cursor:pointer} .btn{background:#1a1c27} .btn:hover{filter:brightness(1.1)}
  .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#041014; border:none; font-weight:700}
  .grid{display:grid;gap:16px} @media(min-width:980px){ .grid-2{grid-template-columns:1fr 1fr} }
  .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01)); border:1px solid var(--border);
        border-radius:18px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .card h2{margin:0 0 8px 0; font-size:16px}
  .pill{font-size:11px;padding:4px 8px;border:1px solid var(--border);border-radius:999px;background:rgba(255,255,255,.05)}
  .opt{display:block;width:100%;text-align:left;margin:6px 0;padding:10px;border-radius:10px;border:1px solid #1f2130;background:#121424}
  .opt.ok{background:var(--ok);color:#041014;border-color:transparent}
  .opt.bad{background:var(--bad);color:#041014;border-color:transparent}
  .kpi{display:flex;gap:8px;align-items:center;font-size:12px} .kpi b{font-size:14px}
  .badge{font-size:11px;background:#7c3aed22;border:1px solid var(--border);padding:4px 8px;border-radius:999px}
  .lock{opacity:.55;filter:grayscale(1)}
</style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="logoWrap">
        <svg width="44" height="44" viewBox="0 0 100 100" role="img" aria-label="Logo ninja">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#7c3aed"/><stop offset="1" stop-color="#22d3ee"/></linearGradient>
          </defs>
          <circle cx="50" cy="50" r="46" fill="url(#g1)" />
          <circle cx="50" cy="50" r="40" fill="#0f1118" stroke="rgba(255,255,255,.15)" stroke-width="1.5"/>
          <path d="M50 16 L56 40 L84 50 L56 60 L50 84 L44 60 L16 50 L44 40 Z" fill="url(#g1)" opacity="0.95" />
        </svg>
        <div>
          <div class="title">FunMaker1404</div>
          <div class="muted">Niveaux par classe ‚Ä¢ Entra√Ænement ‚Ä¢ Langues ‚Ä¢ Programmation ‚Ä¢ Premium par cl√©</div>
        </div>
      </div>
      <div class="row">
        <select id="level">
          <option>Primaire</option><option selected>6e</option><option>5e</option><option>4e</option><option>3e</option><option>Lyc√©e</option>
        </select>
        <select id="subject">
          <option>Maths</option><option>Fran√ßais</option><option>Anglais</option><option>Sciences</option><option selected>Mix</option>
        </select>
        <div class="row">
          <span class="muted">Langues :</span>
          <select id="langFrom"><option value="FR">FR</option><option value="EN" selected>EN</option><option value="ES">ES</option><option value="DE">DE</option></select>
          <span>‚Üí</span>
          <select id="langTo"><option value="FR" selected>FR</option><option value="EN">EN</option><option value="ES">ES</option><option value="DE">DE</option></select>
        </div>
        <button class="btn primary" id="startPack">D√©marrer</button>
        <button class="btn" id="buy">Acheter Premium</button>
        <button class="btn" id="enterKey">Entrer une cl√©</button>
        <span id="premiumBadge" class="badge">Gratuit</span>
      </div>
    </header>

    <div class="grid grid-2">
      <!-- Entra√Ænement adaptatif -->
      <section class="card">
        <div class="row" style="justify-content:space-between">
          <h2>‚ö° Entra√Ænement adaptatif</h2>
          <span class="pill" id="aiMeta">Classe: 6e ‚Ä¢ Diff: 3</span>
        </div>
        <div id="aiZone"></div>
        <div class="row"><button class="btn primary" id="aiStart">Lancer 10 questions</button><span class="muted" id="aiScore"></span></div>
      </section>

      <!-- Programmation ‚Äî Premium -->
      <section class="card" id="codeCard">
        <div class="row" style="justify-content:space-between"><h2>üíª Programmation (Niveau 1 ‚Üí ...)</h2><span class="pill">Premium</span></div>
        <div id="codeLock" class="muted">üîí Contenu Premium ‚Äî ach√®te et entre une cl√© pour d√©verrouiller.</div>
        <div id="codeWrap" style="display:none">
          <div id="codeTask" class="muted"></div>
          <textarea id="codeArea" class="code" rows="7">// √âcris ta fonction solve(...) ici</textarea>
          <div class="row"><button class="btn primary" id="runCode">Tester</button><span id="codeFeedback" class="muted"></span></div>
        </div>
      </section>

      <!-- Langues ‚Äî de base (gratuit) -->
      <section class="card">
        <div class="row" style="justify-content:space-between"><h2>üåç Langues ‚Äî entra√Ænement</h2><span class="pill" id="langMeta">EN ‚Üí FR ‚Ä¢ Lv 1</span></div>
        <div id="langFree"></div>
      </section>

      <!-- Langues Plus ‚Äî Premium -->
      <section class="card" id="langPlusCard">
        <div class="row" style="justify-content:space-between"><h2>üåü Langues Plus</h2><span class="pill">Premium</span></div>
        <div id="langPlus"></div>
      </section>

      <!-- Quiz pr√©d√©finis (exemples) -->
      <section class="card">
        <div class="row" style="justify-content:space-between">
          <h2>üìù Quiz pr√©d√©finis</h2><span class="pill" id="quizMeta">6e ‚Ä¢ Maths</span>
        </div>
        <div id="quizQ"></div><div id="quizChoices"></div>
        <div class="row"><button class="btn" id="prevQuiz">‚óÄ Pr√©c.</button><span class="muted" id="quizIndex">1/1</span><button class="btn" id="nextQuiz">Suiv. ‚ñ∂</button></div>
      </section>

      <!-- Sondage -->
      <section class="card">
        <div class="row" style="justify-content:space-between"><h2>üìä Sondage</h2><span class="muted">Local</span></div>
        <input id="pollTitle" placeholder="Titre du sondage"/><div id="poll"></div>
      </section>

      <!-- Tirage -->
      <section class="card"><h2>üé≤ Tirage au sort</h2>
        <div class="row"><input id="drawInput" placeholder="Noms, s√©par√©s par des virgules"/><button class="btn primary" id="drawBtn">Tirer</button></div>
        <div class="kpi"><span class="muted">Gagnant :</span><b id="drawOut">‚Äî</b></div>
      </section>

      <!-- Timer -->
      <section class="card"><h2>‚è∞ Compte √† rebours</h2>
        <div class="row"><input id="timerMin" type="number" placeholder="Minutes"/><button class="btn primary" id="timerGo">D√©marrer</button></div>
        <div class="kpi"><span class="muted">Temps restant :</span><b id="timer">00:00</b></div>
      </section>
    </div>

    <section class="card muted" style="margin-top:14px">
      <b>Note Premium :</b> remplace dans le code <code>YOUR_PAYMENT_LINK_HERE</code> par ton lien de paiement (Stripe, etc.). Apr√®s achat, donne une **cl√©** √† l‚Äôutilisateur et ajoute son <b>hash SHA-256</b> dans <code>ALLOWED_HASHES</code>.
    </section>
  </div>

<script>
/* ===== Utils ===== */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const rint=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const shuffle=a=>a.map(v=>[v,Math.random()]).sort((x,y)=>x[1]-y[1]).map(x=>x[0]);

/* ===== LIEN DE PAIEMENT ‚Äî REMPLACE ICI =====
 * Mets ici ton lien Stripe Payment Link ou autre.
 * C'est EXACTEMENT l√† que tu changes "YOUR_PAYMENT_LINK_HERE".
 */
const PAYMENT_LINK = "YOUR_PAYMENT_LINK_HERE";

/* ===== Premium par CL√â (hash√©e) =====
 * Remplace les hex ci-dessous par les SHA-256 des cl√©s que TU √©mets.
 */
const ALLOWED_HASHES = [
  "d9b1d7db4cd6e70935368a1efb10e377dce5d5a3a9c3b6ed3c3c8c2cb7a6f0f0", // exemple (√† remplacer)
  "0f343b0931126a20f133d67c2b018a3b2c3c8a5b8c8b1a30aa1a2a2a2a2a2a2a"  // exemple (√† remplacer)
];
let premium = localStorage.getItem("fm_premium_key_ok")==="1";
async function sha256Hex(str){
  const enc=new TextEncoder().encode(str);
  const buf=await crypto.subtle.digest("SHA-256", enc);
  return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function tryKey(){
  const k = prompt("Entre ta cl√© Premium (ex: FM-1234-ABCD) :");
  if(!k) return;
  const h = await sha256Hex(k.trim());
  if(ALLOWED_HASHES.includes(h)){ premium=true; localStorage.setItem("fm_premium_key_ok","1"); alert("‚úÖ Premium activ√© !"); updatePremiumUI(); }
  else { alert("‚ùå Cl√© invalide."); }
}
function updatePremiumUI(){
  $('#premiumBadge').textContent = premium ? "Premium actif" : "Gratuit";
  $('#codeLock').style.display = premium? "none":"block";
  $('#codeWrap').style.display = premium? "block":"none";
  $('#langPlusCard').classList.toggle('lock', !premium);
}
$('#enterKey').onclick=tryKey;
$('#buy').onclick=()=>{ window.open(PAYMENT_LINK, "_blank"); };

/* ===== Profils par CLASSE ‚Äî VRAIES DIFF√âRENCES =====
   Chaque profil r√®gle la difficult√© de d√©part, les plages de nombres
   et les notions autoris√©es (plus on monte en classe, plus on autorise).
*/
const CLASS_PROFILE = {
  "Primaire": { start:2,  nMax:20, allow:{add:true, sub:true, mult:false, frac:false, pct:false, exp:false, eq:false} },
  "6e":       { start:3,  nMax:50, allow:{add:true, sub:true, mult:true,  frac:true,  pct:false, exp:false, eq:false} },
  "5e":       { start:4,  nMax:80, allow:{add:true, sub:true, mult:true,  frac:true,  pct:true,  exp:false, eq:false} },
  "4e":       { start:5,  nMax:120,allow:{add:true, sub:true, mult:true,  frac:true,  pct:true,  exp:true,  eq:false} },
  "3e":       { start:6,  nMax:180,allow:{add:true, sub:true, mult:true,  frac:true,  pct:true,  exp:true,  eq:true } },
  "Lyc√©e":    { start:7,  nMax:350,allow:{add:true, sub:true, mult:true,  frac:true,  pct:true,  exp:true,  eq:true } },
};

/* ===== Entra√Ænement adaptatif ===== */
const state={ diff:3, total:0, good:0 };
function baseDiffFor(level){ return (CLASS_PROFILE[level]||CLASS_PROFILE["6e"]).start; }
function aiMeta(){ $('#aiMeta').textContent=`Classe: ${$('#level').value} ‚Ä¢ Diff: ${state.diff}`; $('#aiScore').textContent=`Score: ${state.good}/${state.total}`; }

function qMath(level, diff){
  const P = CLASS_PROFILE[level] || CLASS_PROFILE["6e"];
  const allow = P.allow, N = P.nMax;
  const types = [];
  if(allow.add||allow.sub) types.push("addsub");
  if(allow.mult) types.push("mult");
  if(allow.frac) types.push("frac");
  if(allow.pct)  types.push("pct");
  if(allow.exp)  types.push("exp");
  if(allow.eq)   types.push("eq");
  const type = types[rint(0,types.length-1)];

  if(type==="addsub"){ const a=rint(1, Math.max(5, Math.floor(N*0.5)+diff*2)), b=rint(1, Math.max(5, Math.floor(N*0.5)+diff*2));
    const op = Math.random()<.5?'+':'-'; const ans= op==='+'?a+b:a-b;
    const opts=shuffle([ans, ans+diff, ans-diff, ans+2]); return {t:`${a} ${op} ${b} = ?`, opts:opts.map(String), ok:opts.indexOf(ans)}; }

  if(type==="mult"){ const a=rint(2, 2+Math.floor(diff*1.5)), b=rint(2, 3+Math.floor(diff*1.5)); const ans=a*b;
    const opts=shuffle([ans, ans+diff, ans-2, ans+3]).map(String); return {t:`${a} √ó ${b} = ?`, opts, ok:opts.indexOf(String(ans))}; }

  if(type==="frac"){ const d=rint(2, 4+Math.floor(diff/2)), n1=rint(1,d-1), n2=rint(1,d-1); const ans=(n1+n2)+'/'+d;
    const opts=shuffle([ans,(n1+n2+1)+'/'+d,(n1+n2-1)+'/'+d,(n1)+'/'+d]); return {t:`${n1}/${d} + ${n2}/${d} = ?`, opts, ok:opts.indexOf(ans)}; }

  if(type==="pct"){ const base=rint(Math.max(40,Math.floor(N*0.6)), N), p=rint(5, 10+diff*5);
    const ans=Math.round(base*p/100); const opts=shuffle([ans, ans+10, ans-10, ans+20]).map(String);
    return {t:`${p}% de ${base} = ?`, opts, ok:opts.indexOf(String(ans))}; }

  if(type==="exp"){ const a=rint(2,3+Math.floor(diff/3)), e=rint(2,3+Math.floor(diff/4)); const ans=String(a**e);
    const opts=shuffle([ans, String(a**(e-1)), String((a+1)**e), String(a**e + a)]);
    return {t:`${a}<sup>${e}</sup> = ?`, html:true, opts, ok:opts.indexOf(ans)}; }

  if(type==="eq"){ const x=rint(1,6+diff), a=rint(1,6+diff), b=rint(1,6+diff), c=a*x+b; const ans=x;
    const opts=shuffle([x,x+1,x-1,x+2]).map(String); return {t:`R√©sous: ${a}x + ${b} = ${c}. x = ?`, opts, ok:opts.indexOf(String(ans))}; }
}

function qFr(level, diff){
  if(level==="Primaire"){ const words=[["le","chat"],["la","maison"],["l'","√©cole"],["les","enfants"]]; const [art,nom]=words[rint(0,words.length-1)];
    const opts=shuffle([art,"le","la","l'","les"]); return {t:`Compl√®te : ___ ${nom}`, opts, ok:opts.indexOf(art)}; }
  if(level==="6e"||level==="5e"){ const pr=["Je","Tu","Il","Elle","Nous","Vous","Ils"][rint(0,6)], v="manger";
    const good = pr==="Je"?"mange":pr==="Tu"?"manges":(pr==="Il"||pr==="Elle")?"mange":pr==="Nous"?"mangeons":pr==="Vous"?"mangez":"mangent";
    const opts=shuffle([good,"manger","mangea","mangera"]); return {t:`Conjugue <b>${v}</b> (pr√©sent) pour ¬´ ${pr} ¬ª`, html:true, opts, ok:opts.indexOf(good)}; }
  // 4e/3e/Lyc√©e : accord/temps simple
  const sents=[["Les chien__ courent.","s"],["Elle prenn__ le bus.","d"],["Nous mange__ demain (futur proche).","ons"]];
  const [txt,miss]=sents[rint(0,sents.length-1)]; const choices=shuffle([miss,"e","ent","ez"]);
  return {t:`Compl√®te : ${txt}`, opts:choices, ok:choices.indexOf(miss)};
}
function qSci(level){ const base=[["Plan√®te rouge ?","Mars",["Jupiter","V√©nus","Mercure"]],
                                   ["√âtoile la plus proche ?","Soleil",["Sirius","Polaris","V√©ga"]]];
  const hard=[["Unit√© SI de force ?","Newton",["Joule","Pascal","Watt"]],
              ["Formule de l‚Äôeau ?","H2O",["CO2","O2","NaCl"]]];
  const pool = (level==="Lyc√©e"||level==="3e"||level==="4e") ? base.concat(hard) : base;
  const [q,a,wr]=pool[rint(0,pool.length-1)]; const opts=shuffle([a,...wr]); return {t:q, opts, ok:opts.indexOf(a)};
}

function genAdaptive(level,subject){
  const pool = subject==="Mix" ? ["Maths","Fran√ßais","Sciences"][rint(0,2)] : subject;
  if(pool==="Maths") return qMath(level, state.diff);
  if(pool==="Fran√ßais") return qFr(level, state.diff);
  if(pool==="Sciences") return qSci(level);
  if(pool==="Anglais") return qLangBasic(); // redirige sur module langues
  return qMath(level, state.diff);
}

$('#aiStart').onclick=()=>{
  state.diff=baseDiffFor($('#level').value);
  state.total=0; state.good=0; aiMeta();
  const zone=$('#aiZone'); zone.innerHTML=''; let i=0;
  function ask(){
    zone.innerHTML='';
    const q=genAdaptive($('#level').value, $('#subject').value);
    const qDiv=document.createElement('div'); qDiv.style.margin='6px 0'; qDiv.innerHTML = q.html? q.t : q.t.replaceAll("<","&lt;");
    zone.append(qDiv);
    q.opts.forEach((o,idx)=>{
      const b=document.createElement('button'); b.className='opt'; b.innerHTML=o;
      b.onclick=()=>{
        state.total++; if(idx===q.ok){ state.good++; state.diff=Math.min(10,state.diff+1); b.classList.add('ok'); } else { state.diff=Math.max(1,state.diff-1); b.classList.add('bad'); }
        aiMeta(); setTimeout(()=>{ if(i<9){ i++; ask(); } else { zone.innerHTML=`<div class="kpi"><span class="muted">R√©sultat</span> ‚Ä¢ <b>${state.good}/10</b> ‚Ä¢ Diff finale: <b>${state.diff}</b></div>`; } }, 550);
      };
      zone.append(b);
    });
  }
  ask();
};

/* ===== Langues (s√©lecteur FR/EN/ES/DE) ===== */
const VOCAB = {
  EN:{FR:[["cat","chat"],["dog","chien"],["house","maison"],["book","livre"],["blue","bleu"]],
      ES:[["cat","gato"],["dog","perro"],["house","casa"],["book","libro"],["blue","azul"]],
      DE:[["cat","Katze"],["dog","Hund"],["house","Haus"],["book","Buch"],["blue","blau"]]},
  FR:{EN:[["chat","cat"],["chien","dog"],["maison","house"],["livre","book"],["bleu","blue"]],
      ES:[["chat","gato"],["chien","perro"],["maison","casa"],["livre","libro"],["bleu","azul"]],
      DE:[["chat","Katze"],["chien","Hund"],["maison","Haus"],["livre","Buch"],["bleu","blau"]]},
  ES:{EN:[["gato","cat"],["perro","dog"],["casa","house"],["libro","book"],["azul","blue"]],
      FR:[["gato","chat"],["perro","chien"],["casa","maison"],["libro","livre"],["azul","bleu"]],
      DE:[["gato","Katze"],["perro","Hund"],["casa","Haus"],["libro","Buch"],["azul","blau"]]},
  DE:{EN:[["Katze","cat"],["Hund","dog"],["Haus","house"],["Buch","book"],["blau","blue"]],
      FR:[["Katze","chat"],["Hund","chien"],["Haus","maison"],["Buch","livre"],["blau","bleu"]],
      ES:[["Katze","gato"],["Hund","perro"],["Haus","casa"],["Buch","libro"],["blau","azul"]]}
};
let langLv=1;
function setLangMeta(){ $('#langMeta').textContent=`${$('#langFrom').value} ‚Üí ${$('#langTo').value} ‚Ä¢ Lv ${langLv}`; }
function qLangBasic(){
  const from=$('#langFrom').value, to=$('#langTo').value;
  const pairs = (VOCAB[from] && VOCAB[from][to]) ? VOCAB[from][to] : [];
  if(!pairs.length){ return {t:"Combinaison non support√©e.", opts:["‚Äî"], ok:0}; }
  const [src,dst]=pairs[rint(0,pairs.length-1)];
  const wrong = shuffle(pairs.filter(([s])=>s!==src).map(([,d])=>d)).slice(0,3);
  const choices = shuffle([dst, ...wrong]);
  return {t:`Traduire <b>${src}</b> ‚Üí ${to}`, html:true, opts:choices, ok:choices.indexOf(dst)};
}
function renderLangFree(){
  const root=$('#langFree'); root.innerHTML='';
  const q=qLangBasic(); setLangMeta();
  const p=document.createElement('div'); p.innerHTML=q.html? q.t : q.t; root.append(p);
  q.opts.forEach((c,idx)=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=c;
    b.onclick=()=>{ if(idx===q.ok){ b.classList.add('ok'); langLv=Math.min(langLv+1,10); } else { b.classList.add('bad'); langLv=Math.max(1,langLv-1); }
      setTimeout(renderLangFree,600); };
    root.append(b);
  });
}

/* Langues Plus (Premium): selon le niveau, on ajoute cloze/phrases/conjugaison */
function renderLangPlus(){
  const root=$('#langPlus'); root.innerHTML='';
  if(!premium){ root.innerHTML='<div class="muted">üîí Premium requis.</div>'; return; }
  const mode = langLv<4 ? "phrase" : langLv<7 ? "conjug" : "cloze";
  if(mode==="phrase"){
    const who=["I","You","He","She","We","They"][rint(0,5)], verb=["like","see","eat","have"][rint(0,3)], obj=["apples","cats","music","books"][rint(0,3)];
    const sent=`${who} ${verb} ${obj}.`;
    const variants=["Nous mange livres.","Je vois pommes.","Elle aime musique."];
    const goodFR=(who==="He"||who==="She"?"Il/Elle":"Je/Nous/Ils")+" "+(verb==="like"?"aime":verb==="see"?"vois":verb==="eat"?"mange":"ai")+" "+(obj==="apples"?"des pommes":obj==="cats"?"les chats":obj==="music"?"la musique":"des livres")+".";
    const choices=shuffle([goodFR,...variants]);
    const p=document.createElement('div'); p.innerHTML=`Traduire en FR : ¬´ ${sent} ¬ª`; root.append(p);
    choices.forEach(x=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=x; b.onclick=()=>{ b.classList.toggle('ok',x===goodFR); if(x===goodFR){ langLv=Math.min(langLv+1,10); } setTimeout(renderLangPlus,700); }; root.append(b); });
  } else if(mode==="conjug"){
    const pr=["Je","Tu","Il","Elle","Nous","Vous","Ils"][rint(0,6)], base="aller";
    const good = {Je:"vais",Tu:"vas",Il:"va",Elle:"va",Nous:"allons",Vous:"allez",Ils:"vont"}[pr];
    const p=document.createElement('div'); p.innerHTML=`Conjugue <b>${base}</b> (pr√©sent) pour ¬´ ${pr} ¬ª`; root.append(p);
    shuffle([good,"aller","ira","allait"]).forEach(c=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=c; b.onclick=()=>{ b.classList.toggle('ok',c===good); if(c===good){ langLv=Math.min(langLv+1,10); } setTimeout(renderLangPlus,700); }; root.append(b); });
  } else {
    const sents=[["I __ apples.","like"],["She __ a book.","has"],["We __ music.","like"]];
    const [s,miss]=sents[rint(0,sents.length-1)];
    const p=document.createElement('div'); p.textContent=`Compl√®te : ${s}`; root.append(p);
    shuffle([miss,"is","are","am"]).forEach(c=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=c; b.onclick=()=>{ b.classList.toggle('ok',c===miss); if(c===miss){ langLv=Math.min(langLv+1,10); } setTimeout(renderLangPlus,700); }; root.append(b); });
  }
}

/* ===== Programmation (Premium) ‚Äî d√©marre niveau 1 et monte √† chaque r√©ussite ===== */
let codeLevel=1, curTask=null;
function qProg(level){
  const L=[];
  L.push(()=>({desc:"Retourne la somme a+b", sig:"function solve(a,b){ /* ton code */ }", tests:[[1,2,3],[5,7,12],[0,0,0]]}));
  L.push(()=>({desc:"Vrai si n est pair", sig:"function solve(n){ /* ton code */ }", tests:[[2,true],[9,false],[0,true]]}));
  L.push(()=>({desc:"Somme d'un tableau", sig:"function solve(arr){ /* ton code */ }", tests:[[[1,2,3],6],[[0,0],0],[[-1,1],0]]}));
  L.push(()=>({desc:"Max d'un tableau", sig:"function solve(arr){ /* ton code */ }", tests:[[[1,5,2],5],[[9,3,-1],9],[[7],7]]}));
  L.push(()=>({desc:"Inverse une cha√Æne", sig:"function solve(s){ /* ton code */ }", tests:[["abc","cba"],["kayak","kayak"],["JS","SJ"]]}));
  L.push(()=>({desc:"Palindrome (ignorer espaces/majuscules)", sig:"function solve(s){ /* ton code */ }", tests:[["A man a plan a canal Panama",true],["kayak",true],["test",false]]}));
  L.push(()=>({desc:"Fr√©quence des lettres (retourne objet)", sig:"function solve(s){ /* ton code */ }", tests:[["aba",{"a":2,"b":1}]]}));
  return L[Math.min(level-1, L.length-1)]();
}
function newCodeTask(){ curTask=qProg(codeLevel); $('#codeTask').innerHTML=`<b>Niveau ${codeLevel}</b> ‚Äî ${curTask.desc}<br/><b>Signature :</b><pre class="code" style="margin-top:6px">${curTask.sig}</pre>`; $('#codeArea').value=curTask.sig+"\n"; }
function evalUser(code){
  try{
    const f = new Function(code + "; return typeof solve==='function'?solve:null;");
    const solve = f();
    if(!solve) return "‚ùå Tu dois d√©finir solve(...)";
    for(const t of curTask.tests){
      const input = Array.isArray(t[0]) && t.length===2 ? t[0] : (t.length===3 ? [t[0],t[1]] : t.slice(0,t.length-1));
      const expected = t[t.length-1];
      const got = Array.isArray(input) ? solve(...input) : solve(input);
      if(JSON.stringify(got)!==JSON.stringify(expected)) return `‚ùå Test rat√©. Entr√©e=${JSON.stringify(input)} ‚Ä¢ Attendu=${JSON.stringify(expected)} ‚Ä¢ Obtenu=${JSON.stringify(got)}`;
    }
    codeLevel = Math.min(codeLevel+1, 7);
    return "‚úÖ Tous les tests OK ! ‚Üí Niveau suivant";
  }catch(e){ return "Erreur: "+e.message; }
}
$('#runCode').onclick=()=>{ if(!premium){ alert("Premium requis."); return; } const res=evalUser($('#codeArea').value); $('#codeFeedback').textContent=res; if(res.startsWith("‚úÖ")) newCodeTask(); };

/* ===== Quiz pr√©d√©finis (petite base) ===== */
const QUIZ_DB=[
  { level:"6e", subject:"Maths", title:"Fractions", q:[{t:"1/2 + 1/2 = ?", opts:["1/4","1","2","1/2"], ok:1},{t:"La moiti√© de 12", opts:["4","6","8","12"], ok:1}]},
  { level:"Lyc√©e", subject:"Informatique", title:"Logique", q:[{t:"true AND false = ?", opts:["true","false"], ok:1},{t:"NOT(true OR false) = ?", opts:["true","false"], ok:1}]},
];
let quizIndex=0;
function listQuiz(){ return QUIZ_DB.filter(q=> q.level===$('#level').value && q.subject===$('#subject').value); }
function renderQuiz(){
  const list=listQuiz(); const meta=$('#quizMeta'); const ch=$('#quizChoices'); const idx=$('#quizIndex');
  $('#quizQ').innerHTML=''; ch.innerHTML='';
  if(!list.length){ meta.textContent=$('#level').value+' ‚Ä¢ '+$('#subject').value; $('#quizQ').innerHTML='<span class="muted">Aucun quiz.</span>'; idx.textContent='‚Äî'; return; }
  const cur=list[quizIndex%list.length]; meta.textContent=`${cur.level} ‚Ä¢ ${cur.subject} ‚Äî ${cur.title}`; idx.textContent=`${(quizIndex%list.length)+1}/${list.length}`;
  cur.q.forEach((qq,qi)=>{ const head=document.createElement('div'); head.innerHTML=`<b>Q${qi+1}.</b> ${qq.t}`; head.style.margin='6px 0'; ch.append(head);
    qq.opts.forEach((o,i)=>{ const b=document.createElement('button'); b.className='opt'; b.textContent=o;
      b.onclick=()=>{ [...ch.querySelectorAll('.opt')].forEach(btn=>btn.classList.remove('ok','bad')); b.classList.add(i===qq.ok?'ok':'bad'); }; ch.append(b); });
  });}
$('#prevQuiz').onclick=()=>{ const l=listQuiz(); if(!l.length) return; quizIndex=(quizIndex-1+l.length)%l.length; renderQuiz(); };
$('#nextQuiz').onclick=()=>{ const l=listQuiz(); if(!l.length) return; quizIndex=(quizIndex+1)%l.length; renderQuiz(); };

/* ===== Sondage / Tirage / Timer (basique) ===== */
const POLL={ title:"Aimes-tu FunMaker ?", options:["Oui","Non","Bof","Je ne sais pas"], votes:[0,0,0,0] };
$('#pollTitle').value=POLL.title; $('#pollTitle').oninput=e=>POLL.title=e.target.value;
function drawPoll(){ const root=$('#poll'); root.innerHTML=''; const title=document.createElement('div'); title.className='muted'; title.textContent=POLL.title; root.append(title);
  POLL.options.forEach((opt,i)=>{ const row=document.createElement('div'); row.style.margin='8px 0';
    const top=document.createElement('div'); top.className='row'; const btn=document.createElement('button'); btn.className='btn'; btn.textContent='Voter';
    const lab=document.createElement('div'); lab.textContent=opt; lab.style.flex='1'; btn.onclick=()=>{ POLL.votes[i]++; updateBars(); };
    top.append(lab,btn); row.append(top); const bar=document.createElement('div'); bar.style.height='8px'; bar.style.background='#222538'; bar.style.borderRadius='999px'; const fill=document.createElement('div'); fill.style.height='8px'; fill.style.background='linear-gradient(90deg,var(--brand),var(--brand2))'; bar.append(fill); row.append(bar); root.append(row); });
  updateBars(); }
function updateBars(){ const bars=$$('#poll div[style*="height: 8px"]'); const tot=POLL.votes.reduce((a,b)=>a+b,0)||1; bars.forEach((b,i)=>{ const f=b.firstChild; f.style.width=Math.round((POLL.votes[i]/tot)*100)+'%'; }); }
drawPoll();

$('#drawBtn').onclick=()=>{ const arr=$('#drawInput').value.split(',').map(s=>s.trim()).filter(Boolean);
  $('#drawOut').textContent=arr.length?arr[Math.floor(Math.random()*arr.length)] : '(ajoute des noms)'; };

let tIv=null; $('#timerGo').onclick=()=>{ clearInterval(tIv); let s=(parseInt($('#timerMin').value)||0)*60;
  const tick=()=>{ if(s<=0){ clearInterval(tIv); $('#timer').textContent='00:00'; return; }
    s--; const m=String(Math.floor(s/60)).padStart(2,'0'), ss=String(s%60).padStart(2,'0'); $('#timer').textContent=`${m}:${ss}`; };
  tick(); tIv=setInterval(tick,1000); };

/* ===== Init ===== */
function refreshAll(){ renderQuiz(); renderLangFree(); renderLangPlus(); if(premium){ newCodeTask(); } aiMeta(); }
$('#startPack').onclick=refreshAll;
window.addEventListener('load', ()=>{ state.diff=baseDiffFor($('#level').value); updatePremiumUI(); refreshAll(); });
$('#level').addEventListener('change', ()=>{ state.diff=baseDiffFor($('#level').value); aiMeta(); renderQuiz(); });
$('#subject').addEventListener('change', renderQuiz);
$('#langFrom').addEventListener('change', ()=>{ renderLangFree(); renderLangPlus(); });
$('#langTo').addEventListener('change', ()=>{ renderLangFree(); renderLangPlus(); });
</script>
</body>
</html>
